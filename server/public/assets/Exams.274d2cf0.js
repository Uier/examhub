var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,r=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&o(e,a,t[a]);return e},c=(e,s)=>t(e,a(s));import{z as i,o as m,f as d,g as u,t as p,n as x,q as y,J as h,i as b,d as v,D as g,k as f,l as k,s as w,y as D,r as E,w as I,F as C,x as T,h as L,u as M,K as O}from"./vendor.b7297cc7.js";import{b as j,a as Y}from"./index.ed08c384.js";import{_ as H}from"./ExamForm.95e6e086.js";const z={props:["name","createTime","content"],setup:()=>({dayjs:i})},P={class:"pl-3 border-l-4 border-rose-200"},Q={class:"text-sm font-medium-text-gray-"},S={class:"text-xs text-gray-500 ml-4"},F={class:"text-sm font-regular text-gray-700"},R={class:"whitespace-pre-line"};z.render=function(e,t,a,s,l,n){return m(),d("div",P,[u("div",null,[u("span",Q,p(a.name),1),u("span",S,p(e.dayjs(a.createTime).format("YYYY-MM-DD HH:mm")),1)]),u("div",F,[u("p",R,p(a.content),1)])])};const U={setup(){const e=x(""),t=x(null);return{value:e,commentInput:t,resize(){t.value.style.cssText="height: auto;",t.value.style.cssText=`height: ${t.value.scrollHeight}px;`}}}},$={class:"flex space-x-5"},_={class:"flex-1"};U.render=function(e,t,a,s,l,n){return m(),d("div",$,[u("div",_,[y(u("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),class:"border border-gray-800 rounded-lg w-full p-2 text-sm resize-none",placeholder:"留言",ref:"commentInput",rows:1,onKeyup:t[2]||(t[2]=(...e)=>s.resize&&s.resize(...e))},null,544),[[h,s.value]])]),u("div",null,[u("button",{type:"button",class:"px-4 py-2 text-sm text-blue-900 bg-blue-100 border-transparent rounded-md hover:bg-blue-200",onClick:t[3]||(t[3]=t=>e.$emit("submit",s.value,(()=>s.value="")))}," 送出 ")])])};const A={},B={width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},K=u("path",{stroke:"none",d:"M0 0h24v24H0z"},null,-1),N=b(),V=u("path",{d:"M7 11v 8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3"},null,-1);A.render=function(e,t){return m(),d("svg",B,[K,N,V])};const W={},X={width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},q=u("path",{stroke:"none",d:"M0 0h24v24H0z"},null,-1),J=b(),G=u("path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v 1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3"},null,-1);W.render=function(e,t){return m(),d("svg",X,[q,J,G])};var Z=v({name:"ExamDetail",components:{Dialog:g,DialogOverlay:f,DialogTitle:k,XIcon:w,TextArea:j,CommentItem:z,CommentInput:U,LikeIcon:A,DislikeIcon:W},props:["data"],setup(e,{emit:t}){const a=D({data:[],isLoading:!0,isError:!1}),s=x(0),l=x([]),n=x(!1),o=()=>{Y.Comment.getList(e.data.docId).then((e=>{a.data=e.data,Promise.all(e.data.map((e=>Y.Comment.getList(e.comId)))).then((e=>{a.data=a.data.map(((t,a)=>c(r({},t),{replies:e[a].data}))),l.value=new Array(a.data.length).fill(!1)}))})).catch((()=>a.isError=!0)).finally((()=>a.isLoading=!1))};return o(),Y.Exam.getVote(e.data.docId).then((e=>s.value=e.data.score)),{comments:a,score:s,isOpenReply:l,createComment(e,t,a){Y.Comment.create({replyId:e,content:t}).then((()=>{a(),o()})).catch((()=>alert("留言失敗了 QQ")))},voteExam(t){Y.Exam.vote(e.data.docId,t).then((()=>s.value=t===s.value?0:t)).catch((()=>alert("評分失敗了 QQ")))},isOpen:n,openModal(){n.value=!0},closeModal(){n.value=!1}}}});const ee={class:"fixed inset-0 z-10 overflow-y-auto"},te={class:"min-h-screen px-4 text-center"},ae=u("span",{class:"inline-block h-screen align-middle","aria-hidden":"true"}," ​ ",-1),se={class:"inline-block w-full md:max-w-4xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},le={class:"w-full flex justify-end"},ne={class:"flex justify-between items-center"},oe={class:"mt-2 mb-4 text-xs"},re={class:"text-gray-500"},ce=b(" Posted on: "),ie={class:"text-gray-800"},me={class:"text-gray-500"},de=b(" Posted by: "),ue={class:"text-gray-800"},pe={class:"flex flex-col items-center space-y-2"},xe={class:"font-mono text-sm text-gray-500"},ye={class:"flex space-x-2"},he={class:"mt-2 min-h-screen-2/3"},be={class:"whitespace-pre-line"},ve={class:"mt-4 mb-2 text-gray-500 text-xs"},ge=b(" Last updated on: "),fe={class:"text-gray-800"},ke=u("hr",null,null,-1),we={key:0},De={key:1};Z.render=function(e,t,a,s,l,n){const o=E("DialogOverlay"),r=E("XIcon"),c=E("DialogTitle"),i=E("LikeIcon"),x=E("DislikeIcon"),y=E("CommentItem"),h=E("CommentInput"),v=E("Dialog");return m(),d("div",null,[u("button",{type:"button",onClick:t[1]||(t[1]=(...t)=>e.openModal&&e.openModal(...t)),class:"text-green-700 text-base"}," 檢視 "),u(v,{as:"div",open:e.isOpen,onClose:e.closeModal},{default:I((()=>[u("div",ee,[u("div",te,[u(o,{class:"fixed inset-0 bg-gray-300 bg-opacity-50"}),ae,u("div",se,[u("div",le,[u("button",{class:"focus:outline-none",type:"button",onClick:t[2]||(t[2]=(...t)=>e.closeModal&&e.closeModal(...t))},[u(r,{class:"h-5 w-5 text-right"})])]),u(c,{as:"h3",class:"text-lg font-medium text-center text-gray-900"},{default:I((()=>[b(p(e.data.title),1)])),_:1}),u("div",ne,[u("div",oe,[u("div",re,[ce,u("span",ie,p(e.data.createTime),1)]),u("div",me,[de,u("span",ue,p(e.data.name),1)])]),u("div",pe,[u("div",null,[u("span",xe," 目前評分："+p(e.data.score),1)]),u("div",ye,[u("button",{class:"focus:outline-none",type:"button",onClick:t[3]||(t[3]=t=>e.voteExam(1))},[1===e.score?(m(),d(i,{key:0,class:"h-6 w-6 text-green-500"})):(m(),d(i,{key:1,class:"h-6 w-6 text-gray-500"}))]),u("button",{class:"focus:outline-none",type:"button",onClick:t[4]||(t[4]=t=>e.voteExam(-1))},[-1===e.score?(m(),d(x,{key:0,class:"h-6 w-6 text-rose-500"})):(m(),d(x,{key:1,class:"h-6 w-6 text-gray-500"}))])])])]),u("div",he,[u("p",be,p(e.data.description),1)]),u("div",ve,[ge,u("span",fe,p(e.data.lastUpdateTime),1)]),ke,e.comments.isLoading?(m(),d("p",we,"Loading...")):e.comments.isError?(m(),d("p",De,"error")):(m(!0),d(C,{key:2},T(e.comments.data,(({comId:t,name:a,content:s,createTime:l,replies:n},o)=>(m(),d(C,{key:t},[u(y,{class:"m-2",name:a,content:s,createTime:l},null,8,["name","content","createTime"]),(m(!0),d(C,null,T(n,(e=>(m(),d(y,{key:e.comId,class:"m-2 ml-10 md:ml-20",name:e.name,content:e.content,createTime:e.createTime},null,8,["name","content","createTime"])))),128)),e.isOpenReply[o]?(m(),d(h,{key:1,class:"ml-10 md:ml-20",onSubmit:(...a)=>e.createComment(t,...a)},null,8,["onSubmit"])):(m(),d("button",{key:0,class:"ml-10 md:ml-20 text-xs text-blue-900 text-opacity-75",type:"button",onClick:t=>e.isOpenReply[o]=!e.isOpenReply[o]}," 回覆 ",8,["onClick"]))],64)))),128)),u(h,{class:"mt-4",onSubmit:t[5]||(t[5]=(...t)=>e.createComment(e.data.docId,...t))})])])])])),_:1},8,["open","onClose"])])};const Ee={props:["tableData","user"],components:{ExamDetail:Z,ExamForm:H,LikeIcon:A,DislikeIcon:W}},Ie={class:"table-fixed my-table"},Ce=u("thead",{class:"bg-rose-200"},[u("tr",null,[u("th",{class:"w-24 my-th"},"學年度"),u("th",{class:"w-20 my-th"},"學期"),u("th",{class:"w-1/5 my-th"},"標題"),u("th",{class:"hidden sm:table-cell my-th"},"詳細資訊"),u("th",{class:"w-24 my-th"},"評分"),u("th",{class:"w-24 my-th"})])],-1),Te={class:"my-tbody"},Le={key:0},Me=u("td",{colspan:"5",class:"my-td"}," 此課程尚無考古題，成為第一個上傳的人吧！ ",-1),Oe={class:"my-td"},je={class:"my-td"},Ye={class:"my-td"},He={class:"hidden sm:table-cell my-td"},ze={class:"block max-h-20 overflow-y-auto break-all"},Pe={class:"my-td"},Qe={class:"flex items-center"},Se={class:"font-mono text-gray-700 text-sm"},Fe={class:"my-td"},Re={class:"flex flex-col items-center space-y-0.5"};Ee.render=function(e,t,a,s,l,n){const o=E("LikeIcon"),r=E("DislikeIcon"),c=E("ExamDetail"),i=E("ExamForm");return m(),d("table",Ie,[Ce,u("tbody",Te,[0===a.tableData.length?(m(),d("tr",Le,[Me])):L("",!0),(m(!0),d(C,null,T(a.tableData,(({docId:s,year:l,semester:n,title:x,description:y,score:h},b)=>(m(),d("tr",{key:s},[u("td",Oe,p(l),1),u("td",je,p(n),1),u("td",Ye,p(x),1),u("td",He,[u("div",ze,p(y),1)]),u("td",Pe,[u("div",Qe,[h>0?(m(),d(o,{key:0,class:"h-5 w-5 mr-1 text-gray-500"})):L("",!0),h<0?(m(),d(r,{key:1,class:"h-5 w-5 mr-1 text-gray-500"})):L("",!0),u("span",Se,p(h>0?h:-h),1)])]),u("td",Fe,[u("div",Re,[u(c,{data:a.tableData[b]},null,8,["data"]),a.user&&a.user.role<=1?(m(),d(C,{key:0},[u(i,{populateWith:a.tableData[b],onSubmit:t[1]||(t[1]=(...t)=>e.$emit("edit-exam",...t))},null,8,["populateWith"]),u("button",{type:"button",class:"text-rose-900 text-base",onClick:t=>e.$emit("delete-exan",s)}," 刪除 ",8,["onClick"])],64)):L("",!0)])])])))),128))])])};var Ue=v({name:"Exams",components:{ExamTable:Ee},setup(){const e=M(),t=D({tableData:[],isLoading:!0,isError:!1}),a=e=>{t.isLoading=!0,Y.Exam.getList(e).then((e=>t.tableData=e.data.map((e=>c(r({},e),{createTime:i(e.createTime).format("YYYY-MM-DD HH:mm"),lastUpdateTime:i(e.lastUpdateTime).format("YYYY-MM-DD HH:mm")}))))).catch((()=>t.isError=!0)).finally((()=>t.isLoading=!1))};return O((()=>e.params.courseId),((e,t)=>{a(Number(e))}),{immediate:!0}),{exams:t,editExam(){alert("Sorry~ 我們還沒做這個功能耶 > <")},deleteExam(t){Y.Exam.delete(t).then((()=>a(Number(e.params.courseId)))).catch((()=>alert("刪除失敗了 QQ")))}}}});const $e={key:0},_e={key:1};Ue.render=function(e,t,a,s,l,n){const o=E("ExamTable");return e.exams.isLoading?(m(),d("p",$e,"Loading...")):e.exams.isError?(m(),d("p",_e,"error")):(m(),d(o,{key:2,tableData:e.exams.tableData,onEditExam:e.editExam,onDeleteExam:e.deleteExam},null,8,["tableData","onEditExam","onDeleteExam"]))};export default Ue;
