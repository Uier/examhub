var e,t,a,n=Object.defineProperty,l=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,i=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,d=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&i(e,a,t[a]);if(o)for(var a of o(t))c.call(t,a)&&i(e,a,t[a]);return e},u=(e,t)=>l(e,s(t));import{a as m,c as p,b as g,d as b,u as x,e as f,r as y,f as h,g as v,w as k,h as E,o as w,i as D,t as _,j as T,F as A,D as L,k as O,l as M,m as U,n as j,p as S,q as R,v as $,s as I,x as V,y as C,z as P,A as F,B as H,C as B}from"./vendor.b7297cc7.js";(e||(e={})).SET_USER="SET_USER",(a=t||(t={})).GET_USER="GET_USER",a.LOGOUT="LOGOUT";const G=m.create({baseURL:"/api"});var Y={Announcement:{get:e=>G.get(`/announcements/${e}`),getList:()=>G.get("/announcements"),create:e=>G.post("/announcements",e),modify:(e,t)=>G.patch(`/announcements/${e}`,t),delete:e=>G.delete(`/announcements/${e}`)},Comment:{getList:e=>G.get("/comments",{params:{areaId:e}}),create:e=>G.post("/comments",e)},Ranking:{getList:()=>G.get("/ranking")},Exam:{get:e=>G.get(`/exam/${e}`),getList:e=>G.get("/exam",{params:e?{courseId:e}:{}}),create:e=>G.post("/exam",e),delete:e=>G.delete(`/exam/${e}`),vote:(e,t)=>G.post(`/exam/${e}/vote`,{score:t}),getVote:e=>G.get(`/exam/${e}/vote`)},Course:{get:e=>G.get(`/courses/${e}`),getList:()=>G.get("/courses"),create:e=>G.post("/courses",e),modify:(e,t)=>G.patch(`/courses/${e}`,t)},Auth:{logout:()=>G.get("/auth/logout")},Users:{get:e=>G.get(`/users/${e}`),getList:()=>G.get("/users"),getMe:()=>G.get("/users/me"),modify:(e,t)=>G.patch(`/users/${e}`,t)}};const Q=p({state:{user:null},getters:{},mutations:{[e.SET_USER](e,t){e.user=t}},actions:{async[t.GET_USER]({commit:t}){try{const{data:a}=await Y.Users.getMe();t(e.SET_USER,a)}catch(a){t(e.SET_USER,null)}},async[t.LOGOUT]({commit:t}){await Y.Auth.logout(),t(e.SET_USER,null)}},plugins:[g()]});function W(){return Q}var z=b({name:"Header",setup(){const e=x(),t=f((()=>"Home"===e.name?"1":"Browse"===e.name?"2":"Manage"===e.name?"3":"Login"===e.name||"User"===e.name?"4":void 0)),a=W(),n=f((()=>a.state.user));return{route:e,defaultActive:t,user:n}}}),q="/assets/logo.8735e2a2.png";const X={class:"bg-rose-300"},J={class:"h-16 px-10 mx-auto flex items-stretch"},K=v("div",{class:"flex justify-start items-center lg:w-0 lg:flex-1 mr-5 md:mr-10"},[v("img",{class:"h-8 w-auto sm:h-12",src:q}),v("h1",{class:"hidden sm:inline text-xl ml-2 text-gray-700 font-medium"},"師大資工考古題")],-1),N={class:"flex-1 flex items-stretch justify-end"},Z=D(" 首頁 "),ee=D(" 考古題 "),te=D(" 管理介面 "),ae=D(" 登入 ");z.render=function(e,t,a,n,l,s){const o=y("router-link");return w(),h("div",X,[v("div",J,[K,v("div",N,[v(o,{to:{name:"Home"},class:[{"bg-rose-200":"Home"===e.route.name},"md:text-lg text-gray-700 font-medium flex-1 hover:bg-rose-200 flex items-center justify-center"]},{default:k((()=>[Z])),_:1},8,["class"]),v(o,{to:{name:"Browse"},class:[{"bg-rose-200":"Browse"===e.route.name||"Exams"===e.route.name},"md:text-lg text-gray-700 font-medium flex-1 hover:bg-rose-200 flex items-center justify-center"]},{default:k((()=>[ee])),_:1},8,["class"]),e.user&&e.user.role<=1?(w(),h(o,{key:0,to:{name:"Manage"},class:[{"bg-rose-200":"Manage"===e.route.name},"md:text-lg text-gray-700 font-medium flex-1 hover:bg-rose-200 flex items-center justify-center"]},{default:k((()=>[te])),_:1},8,["class"])):E("",!0),e.user?(w(),h(o,{key:2,to:{name:"User"},class:[{"bg-rose-200":"User"===e.route.name},"md:text-lg text-gray-700 font-medium flex-1 hover:bg-rose-200 flex items-center justify-center"]},{default:k((()=>[D(_(e.user.name),1)])),_:1},8,["class"])):(w(),h(o,{key:1,to:{name:"Login"},class:[{"bg-rose-200":"Login"===e.route.name},"md:text-lg text-gray-700 font-medium flex-1 hover:bg-rose-200 flex items-center justify-center"]},{default:k((()=>[ae])),_:1},8,["class"]))])])])};const ne={name:"Footer"},le={class:"h-1/5 mx-6 pt-8 pb-16 border-t flex items-center text-gray-700"},se=v("div",{class:"flex-1 text-xs"},[v("a",{href:"https://github.com/Uier/examhub",rel:"noopener noreferrer",target:"_blank",class:"flex items-center"},[D(" ExamHub on GitHub "),v("svg",{class:"h-5 ml-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[v("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"})])])],-1),oe=v("div",{class:"flex-1 flex justify-center"},[v("img",{class:"h-10",src:q,alt:"ExamHub"})],-1),re=v("div",{class:"flex-1 flex flex-col text-xs items-end"},[v("span",null,"2021 DB Final Project 第一組"),v("span",null,"于子緯、紀軒宇、連庭萱、高子翔")],-1);ne.render=function(e,t,a,n,l,s){return w(),h("div",le,[se,oe,re])};var ce=b({name:"App",components:{Header:z,Footer:ne},setup(){const e=W();T((()=>{e.dispatch(t.GET_USER)}))}});const ie={class:"w-full mx-auto min-h-screen flex flex-col justify-between"};let de;ce.render=function(e,t,a,n,l,s){const o=y("Header"),r=y("router-view"),c=y("Footer");return w(),h(A,null,[v(o),v("main",ie,[v(r),v(c)])],64)};const ue={},me=function(e,t){if(!t)return e();if(void 0===de){const e=document.createElement("link").relList;de=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in ue)return;ue[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":de,t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((e,t)=>{n.addEventListener("load",e),n.addEventListener("error",t)})):void 0}))).then((()=>e()))},pe={name:"TextField",props:["label","modelValue","placeholder"]};pe.render=function(e,t,a,n,l,s){return w(),h("div",null,[v("label",{for:`text-field-${a.label}`,class:"block text-sm text-gray-700"},_(a.label),9,["for"]),v("input",{type:"text",id:`text-field-${a.label}`,class:"h-8 w-full p-1 border border-gray-500 rounded",placeholder:a.placeholder,value:a.modelValue,onInput:t[1]||(t[1]=t=>e.$emit("update:modelValue",t.target.value))},null,40,["id","placeholder","value"])])};const ge={name:"TextArea",props:["label","modelValue","placeholder"]};ge.render=function(e,t,a,n,l,s){return w(),h("div",null,[v("label",{for:`text-area-${a.label}`,class:"block text-sm text-gray-700"},_(a.label),9,["for"]),v("textarea",{id:`text-area-${a.label}`,class:"h-32 w-full p-1 border border-gray-500 rounded",placeholder:a.placeholder,value:a.modelValue,onInput:t[1]||(t[1]=t=>e.$emit("update:modelValue",t.target.value))},null,40,["id","placeholder","value"])])};const be={name:"AnnounceForm",components:{Dialog:L,DialogOverlay:O,DialogTitle:M,PlusIcon:U,TextField:pe,TextArea:ge},props:{populateWith:{type:Object,default:()=>({title:"",content:"",pinned:!1})}},setup(e,{emit:t}){const a=j(!1),n=j(null),l=f((()=>e.populateWith.annId?"編輯":"新增公告"));return S(),{btnText:l,isOpen:a,data:n,submit(){t("submit",n.value,this.closeModal)},closeModal(){a.value=!1},openModal(){const{annId:t,title:l,content:s,pinned:o}=e.populateWith;n.value={annId:t,title:l,content:s,pinned:Boolean(o)},a.value=!0}}}},xe={class:"flex items-center text-sm"},fe={class:"fixed inset-0 z-10 overflow-y-auto"},ye={class:"min-h-screen px-4 text-center"},he=v("span",{class:"inline-block h-screen align-middle","aria-hidden":"true"}," ​ ",-1),ve={class:"dialog-container"},ke={class:"mt-2"},Ee=v("label",{for:"pin-ann",class:"mt-2 block text-sm text-gray-700"},"置頂",-1),we=v("option",{value:!1},"否",-1),De=v("option",{value:!0},"是",-1),_e={class:"mt-4"};be.render=function(e,t,a,n,l,s){const o=y("PlusIcon"),r=y("DialogOverlay"),c=y("DialogTitle"),i=y("text-field"),d=y("text-area"),u=y("Dialog");return w(),h("div",null,["新增公告"===n.btnText?(w(),h("button",{key:0,type:"button",onClick:t[1]||(t[1]=(...e)=>n.openModal&&n.openModal(...e)),class:"py-1.5 btn-add"},[v("div",xe,[v(o,{class:"w-4 h-4 mr-0.5"}),D(" "+_(n.btnText),1)])])):(w(),h("button",{key:1,type:"button",onClick:t[2]||(t[2]=(...e)=>n.openModal&&n.openModal(...e)),class:"text-blue-900 text-base"},_(n.btnText),1)),v(u,{as:"div",open:n.isOpen,onClose:n.closeModal},{default:k((()=>[v("div",fe,[v("div",ye,[v(r,{class:"fixed inset-0 bg-gray-300 bg-opacity-50"}),he,v("div",ve,[v(c,{as:"h3",class:"text-lg text-gray-900"},{default:k((()=>[D(_(n.btnText),1)])),_:1}),v("div",ke,[v(i,{modelValue:n.data.title,"onUpdate:modelValue":t[3]||(t[3]=e=>n.data.title=e),label:"標題",class:"mt-2"},null,8,["modelValue"]),Ee,R(v("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.data.pinned=e),id:"pin-ann",class:"h-8 w-full p-1 border border-gray-500 rounded"},[we,De],512),[[$,n.data.pinned]]),v(d,{modelValue:n.data.content,"onUpdate:modelValue":t[5]||(t[5]=e=>n.data.content=e),label:"內容",class:"mt-2"},null,8,["modelValue"])]),v("div",_e,[v("button",{type:"button",class:"btn-submit",onClick:t[6]||(t[6]=(...e)=>n.submit&&n.submit(...e))}," 送出 "),v("button",{type:"button",class:"ml-8 text-sm text-rose-500",onClick:t[7]||(t[7]=(...e)=>n.closeModal&&n.closeModal(...e))}," 取消 ")])])])])])),_:1},8,["open","onClose"])])};const Te={name:"AnnounceDetail",components:{Dialog:L,DialogOverlay:O,DialogTitle:M,XIcon:I},props:["data"],setup(){const e=j(!1);return{isOpen:e,openModal(){e.value=!0},closeModal(){e.value=!1}}}},Ae={class:"fixed inset-0 z-10 overflow-y-auto"},Le={class:"min-h-screen px-4 text-center"},Oe=v("span",{class:"inline-block h-screen align-middle","aria-hidden":"true"}," ​ ",-1),Me={class:"inline-block w-full md:max-w-lg p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},Ue={class:"w-full flex justify-end"},je={class:"mt-2 mb-4 text-xs"},Se={class:"text-gray-500"},Re={class:"text-gray-500"},$e={class:"mt-2"},Ie={class:"whitespace-pre-line"},Ve={class:"mt-4 mb-2 text-gray-500 text-xs"};Te.render=function(e,t,a,n,l,s){const o=y("DialogOverlay"),r=y("XIcon"),c=y("DialogTitle"),i=y("Dialog");return w(),h("div",null,[v("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>n.openModal&&n.openModal(...e)),class:"text-green-700 text-base"}," 檢視 "),v(i,{as:"div",open:n.isOpen,onClose:n.closeModal},{default:k((()=>[v("div",Ae,[v("div",Le,[v(o,{class:"fixed inset-0 bg-gray-300 bg-opacity-50"}),Oe,v("div",Me,[v("div",Ue,[v("button",{class:"focus:outline-none",type:"button",onClick:t[2]||(t[2]=(...e)=>n.closeModal&&n.closeModal(...e))},[v(r,{class:"h-5 w-5 text-right"})])]),v(c,{as:"h3",class:"text-lg font-medium text-center text-gray-900"},{default:k((()=>[D(_(a.data.title),1)])),_:1}),v("div",je,[v("div",Se," Posted on: "+_(a.data.createTime),1),v("div",Re," Posted by: "+_(a.data.name),1)]),v("div",$e,[v("p",Ie,_(a.data.content),1)]),v("div",Ve," Last updated on: "+_(a.data.lastUpdateTime),1)])])])])),_:1},8,["open","onClose"])])};const Ce={name:"AnnounceTable",props:["tableData","user"],components:{AnnounceForm:be,AnnounceDetail:Te}},Pe={class:"table-fixed my-table"},Fe=v("thead",{class:"bg-rose-200"},[v("tr",null,[v("th",{class:"w-32 my-th"},"日期"),v("th",{class:"my-th"},"標題"),v("th",{class:"w-24 hidden sm:table-cell my-th pl-6"},"發布者"),v("th",{class:"w-24 pl-3 md:pl-6 py-4"})])],-1),He={class:"my-tbody"},Be={key:0},Ge=v("td",{colspan:"3",class:"my-td"},"尚無公告",-1),Ye={class:"my-td"},Qe={class:"my-td"},We={class:"block max-h-20 overflow-y-auto break-all"},ze={class:"hidden sm:table-cell my-td pl-6"},qe={class:"my-td"},Xe={class:"flex flex-col items-center space-y-0.5"};Ce.render=function(e,t,a,n,l,s){const o=y("AnnounceDetail"),r=y("AnnounceForm");return w(),h("table",Pe,[Fe,v("tbody",He,[0===a.tableData.length?(w(),h("tr",Be,[Ge])):E("",!0),(w(!0),h(A,null,V(a.tableData,(({createTime:n,title:l,name:s,pinned:c,annId:i},d)=>(w(),h("tr",{key:i},[v("td",Ye,_(n),1),v("td",Qe,[v("div",We,_(c?"📌":"")+" "+_(l),1)]),v("td",ze,_(s),1),v("td",qe,[v("div",Xe,[v(o,{data:a.tableData[d]},null,8,["data"]),a.user&&a.user.role<=1?(w(),h(A,{key:0},[v(r,{populateWith:a.tableData[d],onSubmit:t[1]||(t[1]=(...t)=>e.$emit("edit-ann",...t))},null,8,["populateWith"]),v("button",{type:"button",class:"text-rose-900 text-base",onClick:t=>e.$emit("delete-ann",i)}," 刪除 ",8,["onClick"])],64)):E("",!0)])])])))),128))])])};const Je={name:"RankingTable",props:["tableData"]},Ke={class:"table-auto my-table"},Ne=v("thead",{class:"bg-rose-200"},[v("tr",null,[v("th",{class:"my-th"},"名次"),v("th",{class:"my-th"},"名稱"),v("th",{class:"my-th"},"貢獻值"),v("th",{class:"pl-3 md:pl-6 py-4"})])],-1),Ze={class:"my-tbody"},et={key:0},tt=v("td",{colspan:"3",class:"my-td"}," 尚無資料 ",-1),at={class:"my-td"},nt={class:"my-td"},lt={class:"my-td"};Je.render=function(e,t,a,n,l,s){return w(),h("table",Ke,[Ne,v("tbody",Ze,[0===a.tableData.length?(w(),h("tr",et,[tt])):E("",!0),(w(!0),h(A,null,V(a.tableData,(({rank:e,name:t,contribution:a},n)=>(w(),h("tr",{key:n},[v("td",at,_(e),1),v("td",nt,_(t),1),v("td",lt,_(a),1)])))),128))])])};var st=b({components:{AnnounceForm:be,AnnounceTable:Ce,RankingTable:Je},name:"Home",setup(){const e=W(),t=f((()=>e.state.user)),a=C({tableData:[],isLoading:!0,isError:!1}),n=C({tableData:[],isLoading:!0,isError:!1}),l=()=>{a.isLoading=!0,Y.Announcement.getList().then((e=>{a.tableData=e.data.map((e=>u(d({},e),{createTime:P(e.createTime).format("YYYY-MM-DD"),lastUpdateTime:P(e.lastUpdateTime).format("YYYY-MM-DD")}))).sort(((e,t)=>e.pinned?-1:(t.pinned,1)))})).catch((()=>a.isError=!0)).finally((()=>a.isLoading=!1)),n.isLoading=!0,Y.Ranking.getList().then((e=>{const t=e.data.map((e=>e.contribution)),a=[...new Set(t)].slice(0,10);n.tableData=e.data.map((e=>u(d({},e),{rank:a.indexOf(e.contribution)+1}))).filter((({rank:e})=>-1!==e))})).catch((()=>n.isError=!0)).finally((()=>n.isLoading=!1))};return l(),{announcements:a,ranking:n,createAnnounce(e,t){Y.Announcement.create(e).then((()=>l())).then(t).catch((e=>{console.log(e),alert("新增失敗了 QQ")}))},editAnnounce(e,t){const{annId:a,title:n,content:s,pinned:o}=e,r={title:n,content:s,pinned:o};Y.Announcement.modify(a,r).then((()=>l())).then(t).catch((e=>{console.log(e),alert("修改失敗了 QQ")}))},deleteAnnounce(e){window.confirm("確定要刪除嗎？")&&Y.Announcement.delete(e).then((()=>l())).catch((()=>alert("刪除失敗了 QQ")))},fetchData:l,user:t}}});const ot={class:"my-6 px-10 flex flex-wrap lg:flex-nowrap lg:space-x-10"},rt={class:"flex flex-col w-full lg:w-1/2 mb-8"},ct={class:"mb-4 flex"},it=v("h1",{class:"font-medium text-2xl text-gray-900"},"公告",-1),dt=v("div",{class:"flex-1"},null,-1),ut={key:0},mt={key:1},pt={class:"flex flex-col w-full lg:w-1/2 mb-8"},gt=v("h1",{class:"font-medium text-2xl text-gray-900 mb-4"},"貢獻排行榜",-1),bt={key:0},xt={key:1};st.render=function(e,t,a,n,l,s){const o=y("AnnounceForm"),r=y("AnnounceTable"),c=y("RankingTable");return w(),h("div",ot,[v("div",rt,[v("div",ct,[it,dt,e.user&&e.user.role<=1?(w(),h(o,{key:0,onSubmit:e.createAnnounce},null,8,["onSubmit"])):E("",!0)]),e.announcements.isLoading?(w(),h("p",ut,"Loading...")):e.announcements.isError?(w(),h("p",mt,"error")):(w(),h(r,{key:2,tableData:e.announcements.tableData,user:e.user,onEditAnn:e.editAnnounce,onDeleteAnn:e.deleteAnnounce},null,8,["tableData","user","onEditAnn","onDeleteAnn"]))]),v("div",pt,[gt,e.ranking.isLoading?(w(),h("p",bt,"Loading...")):e.ranking.isError?(w(),h("p",xt,"error")):(w(),h(c,{key:2,tableData:e.ranking.tableData},null,8,["tableData"]))])])};const ft=[{path:"/",name:"Home",component:st},{path:"/browse",name:"Browse",component:()=>me((()=>import("./Browse.5ccc0bbe.js")),["/assets/Browse.5ccc0bbe.js","/assets/vendor.b7297cc7.js","/assets/ExamForm.95e6e086.js"]),children:[{path:":courseId",name:"Exams",component:()=>me((()=>import("./Exams.274d2cf0.js")),["/assets/Exams.274d2cf0.js","/assets/vendor.b7297cc7.js","/assets/ExamForm.95e6e086.js"])}]},{path:"/manage",name:"Manage",component:()=>me((()=>import("./Manage.ac44cba7.js")),["/assets/Manage.ac44cba7.js","/assets/vendor.b7297cc7.js"])},{path:"/login",name:"Login",component:()=>me((()=>import("./Login.19e82ed5.js")),["/assets/Login.19e82ed5.js","/assets/Login.26c4c51d.css","/assets/vendor.b7297cc7.js"])},{path:"/user",name:"User",component:()=>me((()=>import("./User.bc9e3e0f.js")),["/assets/User.bc9e3e0f.js","/assets/vendor.b7297cc7.js"])}],yt=F({history:H(),routes:ft});B(ce).use(yt).use(Q).mount("#app");export{t as A,pe as _,Y as a,ge as b,q as c,W as u};
